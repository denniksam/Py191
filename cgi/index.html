<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Py191</title>
</head>
<body>
    <h1>Py 191</h1>
    <label>Логин:  <input id="user-login"    /></label><br/>
    <label>Пароль: <input id="user-password" /></label><br/>
    <input type="button" value="Войти" id="login-button" />
    <br/>
    <br/>
    <input type="button" value="Контент" id="items-button" />
    <p id="out"></p>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const loginButton = document.querySelector("#login-button");
    if( ! loginButton ) throw "DOMContentLoaded: #login-button not found" ;
    loginButton.addEventListener('click', loginButtonClick ) ;

    const itemsButton = document.querySelector("#items-button");
    if( ! itemsButton ) throw "DOMContentLoaded: #items-button not found" ;
    itemsButton.addEventListener('click', itemsButtonClick ) ;
});
function itemsButtonClick(e) {
// Д.З. По нажатию на items-button реализовать отправку запроса к /items
// Указать заголовок Authorization: Bearer и подставить полученый при 
// авторизации токен
// *изначально кнопка неактивна, активируется в случае успешной авторизации (получении токена)
}
function loginButtonClick(e) {
    const userLogin = document.querySelector("#user-login");
    if( ! userLogin ) throw "loginButtonClick: #user-login not found" ; 
    const userPassword = document.querySelector("#user-password");
    if( ! userPassword ) throw "loginButtonClick: #user-password not found" ;
    // проверить поля на пустоту, логин - на допустимые символы
    const credentials = btoa( userLogin.value + ':' + userPassword.value ) ;
    fetch( "/auth", {
        method: 'GET',
        headers: {
            'Authorization': 'Basic ' + credentials
        }
    }).then( r => {
        if( r.status != 200 ) {
            alert( "Логин или пароль неправильные" )
        }
        else {
            r.text().then( t => {
                console.log( t ) ;
            });
        }
    } ) ;

}
</script>
</body>
</html>